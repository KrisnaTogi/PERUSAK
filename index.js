const databaseRS = {
  jaksel: [
    {
      nama: 'RS Harapan Kasih',
      alamat: 'Jl. Mangga no. 10',
      kontak: '021-5362745',
      kamarTersedia: {
        I: 50,
        II: 50,
        III: 0
      },
      gambarURL:
        'https://images.adsttc.com/media/images/5181/866a/b3fc/4bde/c800/0050/newsletter/%CE%A9%C2%A8%C2%A1%C3%93%E2%88%8F%EF%AC%81%C2%B5%EF%A3%BF(re-a3)-01.jpg?1367443039'
    },
    {
      nama: 'RS Bunda',
      alamat: 'Jl. Pear no. 1102',
      kontak: '021-5345555',
      kamarTersedia: {
        I: 5,
        II: 10,
        III: 2
      },
      gambarURL:
        'https://marvel-b1-cdn.bc0a.com/f00000000067087/www.bdcnetwork.com/sites/bdc/files/styles/content_display_image/public/image1.jpg?itok=OENUBl0H'
    },
    {
      nama: 'RS Cahaya',
      alamat: 'Jl. Cahaya no. 28',
      kontak: '021-999999',
      kamarTersedia: {
        I: 0,
        II: 1,
        III: 0
      },
      gambarURL:
        'https://edgebuildings.com/wp-content/uploads/2015/11/banner-bt-hospitals.jpg'
    }
  ],
  jakbar: [
    {
      nama: 'RS Air Api',
      alamat: 'Jl. Raya no. 00',
      kontak: '021-2323425',
      kamarTersedia: {
        I: 20,
        II: 4,
        III: 11
      },
      gambarURL:
        'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSTonBeJUfVbCtchir_C4ky5wSYg0SOV5w8eA&usqp=CAU'
    },
    {
      nama: 'RS Bapak',
      alamat: 'Jl. Hulu no. 41',
      kontak: '021-000000',
      kamarTersedia: {
        I: 12,
        II: 49,
        III: 20
      },
      gambarURL:
        'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTp-XNxnPoSsCOO_Jqcqym8wjCMdzeGv8kZNQ&usqp=CAU'
    },
    {
      nama: 'RS Kebun Labu',
      alamat: 'Jl. Labu no. 88',
      kontak: '021-094353',
      kamarTersedia: {
        I: 1,
        II: 0,
        III: 0
      },
      gambarURL:
        'https://thumbs.dreamstime.com/b/elisabeth-hospital-bad-ischl-austria-exterior-old-kaiserin-krankenhaus-colorful-winter-sunset-160629088.jpg'
    }
  ],
  jakut: [
    {
      nama: 'RS Utara',
      alamat: 'Jl. Selatan no. 24',
      kontak: '021-738625',
      kamarTersedia: {
        I: 0,
        II: 2,
        III: 0
      },
      gambarURL: 'https://s.hdnux.com/photos/01/11/16/61/19197022/3/1200x0.jpg'
    },
    {
      nama: 'RS Selamat',
      alamat: 'Jl. Baru no. 22',
      kontak: '021-10294',
      kamarTersedia: {
        I: 12,
        II: 19,
        III: 3
      },
      gambarURL:
        'https://www.vaidam.com/sites/default/files/hospitals/continental_hospital_-_building.jpg'
    },
    {
      nama: 'RS Sungai',
      alamat: 'Jl. Koi no. 80',
      kontak: '021-02737',
      kamarTersedia: {
        I: 27,
        II: 0,
        III: 0
      },
      gambarURL:
        'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRLCEpwTu85tZhb8BZELBCkCSorrLEW-Y9NwQ&usqp=CAU'
    }
  ],
  jakpus: [
    {
      nama: 'RS Pusat',
      alamat: 'Jl. Monas no. 2124',
      kontak: '021-593322',
      kamarTersedia: {
        I: 90,
        II: 1000,
        III: 13
      },
      gambarURL:
        'https://u8k6t9e4.stackpathcdn.com/wp-content/uploads/Lines-of-Business/Hospital-Building/POSTED/B-WI_Columbia-StMarys_Hospital_2_DriDesign_lo-1900x1264.jpg'
    },
    {
      nama: 'RS Hacktiv',
      alamat: 'Jl. Hacktiv no. 88',
      kontak: '021-888888',
      kamarTersedia: {
        I: 21,
        II: 41,
        III: 12
      },
      gambarURL:
        'https://www.bdcnetwork.com/sites/bdc/files/styles/content_display_image/public/Beverly%20Knight%20Olson%20Children%E2%80%99s%20Hospital%2C%202019%20Healthcare%20Giants%20Report%2C%202019%20Giants%20300%20Report%2C%20Robins%20Morton%20Mount%20Sinai%20Photo%203_Beverly%20Knight%20Olson%20Children%E2%80%99s%20Hospital%20exterior_Robins%20%20%26%20Morton.jpg?itok=TcYZUM1g'
    },
    {
      nama: 'RS Kota',
      alamat: 'Jl. Kota no. 100',
      kontak: '021-402456',
      kamarTersedia: {
        I: 130,
        II: 11,
        III: 0
      },
      gambarURL:
        'https://memetemplatehouse.com/wp-content/uploads/2020/07/joker-bombing-hospital-1024x576-1.jpg'
    }
  ],
  jaktim: [
    {
      nama: 'RS Bootstrap',
      alamat: 'Jl. Pusing no. 80',
      kontak: '021-446373',
      kamarTersedia: {
        I: 11,
        II: 1,
        III: 9
      },
      gambarURL:
        'https://www.tatamulia.co.id/contents/gallery/V4WGc720191205144644.jpg'
    },
    {
      nama: 'RS Bayi',
      alamat: 'Jl. Ibu no. 90',
      kontak: '021-162534',
      kamarTersedia: {
        I: 0,
        II: 2,
        III: 15
      },
      gambarURL:
        'https://media.glassdoor.com/l/511569/aster-dm-healthcare-office.jpg'
    },
    {
      nama: 'RS 88',
      alamat: 'Jl. Delapan no. 90',
      kontak: '021-124789',
      kamarTersedia: {
        I: 8,
        II: 8,
        III: 8
      },
      gambarURL:
        'https://kingwood247er.com/wp-content/uploads/2018/07/KEC-Building.jpg'
    }
  ]
};

const databasePenyakit = {
  I: ['Rabies', 'HIV', 'Smallpox', 'COPID'],

  II: ['Hepatitis', 'Malaria', 'Tetanus', 'Infeksi'],

  III: ['Diare', 'Sakit Kepala', 'Iritasi', 'Lapar']
};

let dbPasien = [
  {
    nama: 'luis',
    kelas: 'I',
    domisili: 'jaksel',
    rumahSakit: {
      nama: 'RS Harapan Kasih',
      alamat: 'Jl. Mangga no. 10',
      kontak: '021-5362745',
      kamarTersedia: 50,
      gambarURL: ''
    }
  }
];

let tempSelectionBook = {};

let userForm = document.getElementById('user-form');
let userPage = document.getElementById('user-page');
const homepage = document.getElementById('homepage');
const selectHospital = document.getElementById('selectHospital');
const nameInput = document.getElementById('name');
const selectCity = document.getElementById('selected-city');
const selectDisease = document.getElementById('selected-disease');
const warningLabel = document.getElementById('warning-label');
const warningLabelGroup = document.getElementById('warning-label-group');
const successPage = document.getElementById('successPage');
const btnBack = document.getElementById('btnBack');
const logo = document.getElementById('logo');
const modal = document.getElementById('modal');
const btnAccept = document.getElementById('modal-accept');
const btnDecline = document.getElementById('modal-decline');
const bookingSearch = document.getElementById('booking-search');
const bookingTable = document.getElementById('booking-table');
const bookingList = document.getElementById('booking-list');
const bookingFail = document.getElementById('booking-fail');

nameInput.addEventListener('keyup', function (e) {
  if (e.target.value) {
    nameInput.classList.remove('inputWarning');
  }
});

selectCity.addEventListener('change', function (e) {
  if (e.target.selectedIndex !== 0) {
    selectCity.classList.remove('inputWarning');
  }
});

selectDisease.addEventListener('change', function (e) {
  if (selectDisease.selectedIndex !== 0) {
    selectDisease.classList.remove('inputWarning');
  }
});

logo.addEventListener('click', function () {
  pindahHalaman1();
});

selectCity.addEventListener('change', function (e) {
  pinCity(e.target.value);
});

function pinCity(city) {
  const jakpusPin = document.getElementById('jakpus-pin');
  const jakutPin = document.getElementById('jakut-pin');
  const jaktimPin = document.getElementById('jaktim-pin');
  const jakselPin = document.getElementById('jaksel-pin');
  const jakbarPin = document.getElementById('jakbar-pin');

  switch (city) {
    case 'jakpus':
      jakpusPin.classList.remove('d-none');
      jakutPin.classList.add('d-none');
      jaktimPin.classList.add('d-none');
      jakselPin.classList.add('d-none');
      jakbarPin.classList.add('d-none');
      break;
    case 'jakut':
      jakpusPin.classList.add('d-none');
      jakutPin.classList.remove('d-none');
      jaktimPin.classList.add('d-none');
      jakselPin.classList.add('d-none');
      jakbarPin.classList.add('d-none');
      break;
    case 'jaktim':
      jakpusPin.classList.add('d-none');
      jakutPin.classList.add('d-none');
      jaktimPin.classList.remove('d-none');
      jakselPin.classList.add('d-none');
      jakbarPin.classList.add('d-none');
      break;
    case 'jaksel':
      jakpusPin.classList.add('d-none');
      jakutPin.classList.add('d-none');
      jaktimPin.classList.add('d-none');
      jakselPin.classList.remove('d-none');
      jakbarPin.classList.add('d-none');
      break;
    case 'jakbar':
      jakpusPin.classList.add('d-none');
      jakutPin.classList.add('d-none');
      jaktimPin.classList.add('d-none');
      jakselPin.classList.add('d-none');
      jakbarPin.classList.remove('d-none');
      break;
    case 'blank':
      jakpusPin.classList.add('d-none');
      jakutPin.classList.add('d-none');
      jaktimPin.classList.add('d-none');
      jakselPin.classList.add('d-none');
      jakbarPin.classList.add('d-none');
      break;
    default:
      break;
  }
}

btnBack.addEventListener('click', function () {
  pindahHalaman1();
});

userForm.addEventListener('submit', function (e) {
  e.preventDefault();

  const dataPasien = tarikData(e); // {nama: luis, domisili: jaksel, penyakit: diare}

  if (dataPasien) {
    const daftarRumahSakit = rumahSakitList(
      dataPasien,
      databaseRS,
      null,
      databasePenyakit
    );
    showHospital(daftarRumahSakit);

    pindahHalaman2();
  }
});

function tarikData(event) {
  const nama = event.target[0].value;
  const domisili = event.target[1].value;
  const penyakit = event.target[2].value;
  let warningWord = [];

  if (!nama) {
    nameInput.classList.add('inputWarning');
    warningWord.push('Nama Loe');
  }
  if (domisili === 'Cari Lokasi Loe!') {
    selectCity.classList.add('inputWarning');
    warningWord.push('Lokasi Loe');
  }
  if (penyakit === 'Loe Sakit Apa?') {
    selectDisease.classList.add('inputWarning');
    warningWord.push('Penyakit Loe');
  }

  if (
    !nama ||
    domisili === 'Cari Lokasi Loe!' ||
    penyakit === 'Loe Sakit Apa?'
  ) {
    warningLabel.textContent = `Masukin ${warningWord.join(', ')}!`;
    warningLabelGroup.classList.remove('d-none');
    return;
  }

  event.target[0].value = '';
  event.target[0].placeholder = 'Masukin Nama Loe!';
  event.target[1].selectedIndex = 0;
  event.target[2].selectedIndex = 0;
  pinCity('blank');
  warningWord = [];
  warningLabelGroup.classList.add('d-none');
  nameInput.classList.remove('inputWarning');
  selectCity.classList.remove('inputWarning');
  selectDisease.classList.remove('inputWarning');

  return {
    nama,
    domisili,
    penyakit
  };
}

function pindahHalaman1() {
  homepage.classList.remove('d-none');
  selectHospital.classList.add('d-none');
  successPage.classList.add('d-none');
}

function pindahHalaman2() {
  homepage.classList.add('d-none');
  selectHospital.classList.remove('d-none');
  successPage.classList.add('d-none');
}

function pindahHalaman3() {
  homepage.classList.add('d-none');
  selectHospital.classList.add('d-none');
  successPage.classList.remove('d-none');
}

function rumahSakitList(dataPasien, databaseRS, kelasPasien, databasePenyakit) {
  let output = {
    nama: dataPasien.nama,
    domisili: dataPasien.domisili,
    kelas: '',
    rumahSakitList: []
  };

  if (!kelasPasien) {
    for (const key in databasePenyakit) {
      for (const value of databasePenyakit[key]) {
        if (dataPasien.penyakit === value) {
          output.kelas = key;
          break;
        }
      }
    }
  } else {
    output.kelas = kelasPasien;
  }

  const rumahSakitTerpilih = databaseRS[dataPasien.domisili]; // reference

  for (const rumahSakit of rumahSakitTerpilih) {
    if (rumahSakit.kamarTersedia[output.kelas] != 0) {
      // rumahSakit.kamarTersedia = rumahSakit.kamarTersedia[output.kelas];
      output.rumahSakitList.push(rumahSakit);
    }
  }
  return output;
}

function showHospital(rumahSakitList, rumahSakitExisting) {
  let output = ``;
  const cardHospitals = document.getElementById('cardHospitals');

  for (const rumahSakit of rumahSakitList.rumahSakitList) {
    output += `<div class="card m-2" style="width: 18rem">
    <img
      src="${rumahSakit.gambarURL}"
      class="card-img-top"
      alt="${rumahSakit.nama}"
    />
    <div class="card-body">
      <h5 class="card-title">${rumahSakit.nama}</h5>
      <p class="card-text">${rumahSakit.alamat}</p>
      <a href="#" id="${rumahSakit.nama}" class="btn btn-block btn-primary selectHospital">Pilih</a>
    </div>
  </div>`;
  }

  cardHospitals.innerHTML = output;

  const btnsSelectHospital = document.getElementsByClassName('selectHospital');

  for (const btnSelectHospital of btnsSelectHospital) {
    btnSelectHospital.addEventListener('click', function (e) {
      const rumahSakitTujuan = {
        nama: rumahSakitList.nama,
        kelas: rumahSakitList.kelas,
        domisili: rumahSakitList.domisili
      };

      for (const rumahSakit of rumahSakitList.rumahSakitList) {
        if (rumahSakit.nama === btnSelectHospital.id) {
          rumahSakitTujuan.rumahSakit = rumahSakit;
        }
      }

      tempSelectionBook = rumahSakitTujuan;

      if (rumahSakitExisting) {
        for (let i = 0; i < dbPasien.length; i++) {
          const pasien = dbPasien[i];

          if (rumahSakitExisting === pasien.rumahSakit.nama) {
            dbPasien.splice(i, 1);
          }
        }
      }

      showModal();
    });
  }
}

btnDecline.addEventListener('click', function () {
  modal.classList.add('d-none');
});

btnAccept.addEventListener('click', function () {
  dbPasien.push(tempSelectionBook);
  closeModal();

  const namaPasien = document.getElementById('namaPasien');
  const namaRS = document.getElementById('namaRS');
  const alamatRS = document.getElementById('alamatRS');
  const kontakRS = document.getElementById('kontakRS');

  namaPasien.textContent = tempSelectionBook.nama;
  namaRS.textContent = tempSelectionBook['rumahSakit'].nama;
  alamatRS.textContent = tempSelectionBook['rumahSakit'].alamat;
  kontakRS.textContent = tempSelectionBook['rumahSakit'].kontak;

  pindahHalaman3();
});

function pushBookingPasien() {
  dbPasien.push();
}

function showModal() {
  modal.classList.remove('d-none');
}

function closeModal() {
  modal.classList.add('d-none');
}

function showBookingList(namaPasien) {
  bookingList.innerHTML = ``;

  for (let i = 0; i < dbPasien.length; i++) {
    const pasien = dbPasien[i];

    if (namaPasien === pasien.nama) {
      bookingTable.classList.remove('d-none');
      bookingFail.classList.add('d-none');

      bookingList.innerHTML += `<div class="row py-1 bg-light d-flex justify-content-center align-items-center">
      <div class="col-1 text-center">
        ${i + 1}
      </div>
      <div class="col-4">
        ${pasien.nama}
      </div>
      <div class="col-5 text-center">
        ${pasien.rumahSakit.nama}
      </div>
      <div class="col-1 text-center">
        <button class="btn btn-primary btnUpdate">Update</button>
      </div>
      <div class="col-1 text-center">
        <button class="btn btn-danger btnDelete">Delete</button>
      </div>
    </div>`;

      const btnsUpdate = document.getElementsByClassName('btnUpdate');
      const btnsDelete = document.getElementsByClassName('btnDelete');

      for (let j = 0; j < btnsUpdate.length; j++) {
        const btnUpdate = btnsUpdate[j];
        const btnDelete = btnsDelete[j];

        btnUpdate.addEventListener('click', function () {
          const dataPasien = {
            nama: pasien.nama,
            domisili: dbPasien[j].domisili
          };

          showHospital(
            rumahSakitList(
              dataPasien,
              databaseRS,
              dbPasien[j].kelas,
              databasePenyakit
            ),
            dbPasien[j].rumahSakit.nama
          );

          pindahHalaman2();
        });

        btnDelete.addEventListener('click', function () {
          deleteBooking(j);

          // for (let i = 0; i <= dbPasien.length; i++) {
          //   if (dbPasien.length === 0) {
          //     bookingTable.classList.add('d-none');
          //   } else if (dbPasien[i].nama !== namaPasien) {
          //     bookingTable.classList.add('d-none');
          //   }
          // }
        });
      }
    } else {
      bookingTable.classList.add('d-none');
      bookingFail.classList.remove('d-none');
    }
  }
}

bookingSearch.addEventListener('submit', function (e) {
  e.preventDefault();
  const namaPasien = e.target[0].value;

  showBookingList(namaPasien);
  e.target[0].value = '';
});

function deleteBooking(index) {
  // luis di RS harapan kasih
  // index 0
  dbPasien.splice(index, 1);
}

// {
//     nama: 'luis',
//     kelas: 'I',
//     rumahSakitList: [
//       {
//         nama: 'RS Harapan Kasih',
//         alamat: 'Jl. Mangga no. 10',
//         kontak: '021-5362745',
//         kamarTersedia: 50,
//         gambarURL: ''
//       },
//       {
//         nama: 'RS Bunda',
//         alamat: 'Jl. Pear no. 1102',
//         kontak: '021-5345555',
//         kamarTersedia: 5,
//         gambarURL: ''
//       }
//     ]
//   }

// {
//     nama: 'luis',
//     rumahSakit: {
//         nama: 'RS Harapan Kasih',
//         alamat: 'Jl. Mangga no. 10',
//         kontak: '021-5362745',
//         kamarTersedia: 50,
//         gambarURL: ''
//       }
// }
